[uwsgi]
module = server:app
plugin = python3
virtualenv = /tmp/venv/
master = true
need-app = true
enable-threads = true
single-interpreter = true
vacuum = true
die-on-term = true
lazy-apps = true
thunder-lock = true
listen = 1024

; Socket behind a proxy
socket = 0.0.0.0:29000
so-keepalive = true
tcp-keepalive = 2

; Pool size
processes = 16
threads = 8

; cheaper algo
cheaper-algo = spare
cheaper = 8
cheaper-initial = 16
cheaper-step = 2

; Worker expiry settings
max-worker-lifetime = 3600
worker-reload-mercy = 120
reload-mercy = 120
harakiri = 0

; --- I/O robustness ---
socket-timeout = 600
http-timeout   = 600
buffer-size    = 65535
ignore-sigpipe = true
ignore-write-errors = true
disable-write-exception = true
offload-threads = 4

; disk post buffering (protects against worker churn)
post-buffering = 1048576
post-buffering-bufsize = 65536

; --- Leak control / periodic refresh ---
max-requests = 1000
reload-on-rss = 2048

; --- Observability ---
master-fifo = /tmp/uwsgi_fifo
memory-report = true
stats = :9191
